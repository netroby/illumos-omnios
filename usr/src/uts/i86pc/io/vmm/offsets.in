/*
 * COPYRIGHT 2014 Pluribus Networks Inc.
 *
 * All rights reserved. This copyright notice is Copyright Management
 * Information under 17 USC 1202 and is included to protect this work and
 * deter copyright infringement.  Removal or alteration of this Copyright
 * Management Information without the express written permission from
 * Pluribus Networks Inc is prohibited, and any such unauthorized removal
 * or alteration will be a violation of federal law.
 */
#include <sys/types.h>
#include <sys/param.h>
#include <sys/systm.h>
#include <sys/cpuvar.h>

#include <machine/pmap.h>

#include <machine/vmm.h>
#include "intel/vmx_cpufunc.h"
#include "intel/vmx.h"

vmxctx
	tmpstktop	VMXCTX_TMPSTKTOP
	guest_rdi	VMXCTX_GUEST_RDI
	guest_rsi	VMXCTX_GUEST_RSI
	guest_rdx	VMXCTX_GUEST_RDX
	guest_rcx	VMXCTX_GUEST_RCX
	guest_r8	VMXCTX_GUEST_R8
	guest_r9	VMXCTX_GUEST_R9
	guest_rax	VMXCTX_GUEST_RAX
	guest_rbx	VMXCTX_GUEST_RBX
	guest_rbp	VMXCTX_GUEST_RBP
	guest_r10	VMXCTX_GUEST_R10
	guest_r11	VMXCTX_GUEST_R11
	guest_r12	VMXCTX_GUEST_R12
	guest_r13	VMXCTX_GUEST_R13
	guest_r14	VMXCTX_GUEST_R14
	guest_r15	VMXCTX_GUEST_R15
	guest_cr2	VMXCTX_GUEST_CR2
	host_r15	VMXCTX_HOST_R15
	host_r14	VMXCTX_HOST_R14
	host_r13	VMXCTX_HOST_R13
	host_r12	VMXCTX_HOST_R12
	host_rbp	VMXCTX_HOST_RBP
	host_rsp	VMXCTX_HOST_RSP
	host_rbx	VMXCTX_HOST_RBX
	host_rip	VMXCTX_HOST_RIP
	launch_error	VMXCTX_LAUNCH_ERROR

vmx			VMX_SIZE

\#define	VM_SUCCESS		0
\#define	VM_FAIL_INVALID		1
\#define	VM_FAIL_VALID		2

\#define	VMX_RETURN_DIRECT	0
\#define	VMX_RETURN_LONGJMP	1
\#define	VMX_RETURN_VMRESUME	2
\#define	VMX_RETURN_VMLAUNCH	3
\#define	VMX_RETURN_AST		4

cpu
	cpu_thread

_kthread
	t_lwp
	_tu._ts._t_astflag	T_ASTFLAG
